#!/usr/bin/env bash

set -eo pipefail

# Get the directory this script is stored in
DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Dotfiles to symlink to ~/.<dotfile>
DOTFILES=(gitconfig gitignore_global vimrc zshenv zshrc)

# Folder symlinks, mapped from source (in $DIR) to destination
declare -A FOLDERS=(
  [vim]="$HOME/.vim"
  [yarn]="$HOME/.config/yarn"
  [nvim]="$HOME/.config/nvim"
  [bin]="$HOME/bin"
)

set -u

link_item() {
  local src=$1
  local dest=$2

  echo
  echo "Linking $src â†’ $dest"

  if [ -e "$dest" ] || [ -L "$dest" ]; then
    read -p "$dest exists, overwrite? (y/n) " -n 1 -r
    echo
    if [[ "$REPLY" =~ ^[Yy]$ ]]; then
      rm -rf "$dest"
      ln -s "$src" "$dest"
      echo " ...overwrote $dest"
    else
      echo " ...skipped"
    fi
  else
    ln -s "$src" "$dest"
    echo " ...linked $dest"
  fi
}

# Link dotfiles
for dotfile in "${DOTFILES[@]}"; do
  link_item "$DIR/$dotfile" "$HOME/.$dotfile"
done

# Link folders
for folder in "${!FOLDERS[@]}"; do
  link_item "$DIR/$folder" "${FOLDERS[$folder]}"
done
